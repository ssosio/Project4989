<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boot.sagu.mapper.PostsMapperInter">
<insert id="insertPost" parameterType="posts" useGeneratedKeys="true" keyProperty="postId">
	INSERT INTO posts(member_id,title,price,trade_type,auction_end_time,created_at,post_type,content) 
VALUES(#{memberId},#{title},#{price},#{tradeType},
		CASE
        WHEN #{tradeType} = 'AUCTION'
        THEN DATE_ADD(CONVERT_TZ(NOW(), 'UTC', 'Asia/Seoul'), INTERVAL 24 HOUR)
        ELSE NULL END, CONVERT_TZ(NOW(), 'UTC', 'Asia/Seoul'),#{postType},#{content})
</insert>
<select id="getAllPostData" resultType="posts">
	SELECT p.*, 
	       (SELECT photo_url FROM post_photos WHERE post_id = p.post_id AND is_main = 1 LIMIT 1) as mainPhotoUrl
	FROM posts p 
	ORDER BY p.post_id DESC
</select>
<select id="getPostData" resultType="posts" parameterType="Long">
	SELECT p.*, 
	       (SELECT photo_url FROM post_photos WHERE post_id = p.post_id AND is_main = 1 LIMIT 1) as mainPhotoUrl
	FROM posts p 
	where post_id=#{postId}
</select>
</mapper>